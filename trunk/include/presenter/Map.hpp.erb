
<% header_guard do %>

#include "all_fwd.hpp"
#include "model/Cube.hpp"
#include <boost/tr1/memory.hpp>
#include <list>

namespace psc{ namespace presenter{

class Map: public std::tr1::enable_shared_from_this<Map>{
public:
    typedef std::tr1::shared_ptr<Map> pointer_type;
    typedef std::list<pCube> CubeList;

public:
    static pointer_type create(data::pMapSetting setting){ return pointer_type(new Map(setting))->init(); }

public:
    Map(data::pMapSetting setting): setting_(setting){}

public:
    pCube make_cube(int x, int y, int color_id = 0){
        pCube cube = Cube::create(shared_from_this(), x, y, color_id);
        cubes_.push_back(cube);
        return cube;
    }

private:
    pointer_type init(){
        model_ = model::Map::create(shared_from_this(), setting_);
        view_ = view::Map::create(shared_from_this());
        return shared_from_this();
    }

private:
    data::pMapSetting setting_;
    model::pMap model_;
    view::pMap view_;
    CubeList cubes_;
};

}} // end of namespace

<% end %>
